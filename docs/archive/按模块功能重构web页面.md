# Webå‰ç«¯ç®¡ç†åå°æ¨¡å—åŒ–é‡æ„è¯¦ç»†è®¡åˆ’

## ğŸ“‹ é‡æ„ç›®æ ‡

æ ¹æ®V2.0è®¾è®¡æ–‡æ¡£è¦æ±‚ï¼Œå°†å½“å‰è¿”å›500é”™è¯¯çš„Webç®¡ç†åå°é‡æ„ä¸ºå®Œå…¨åŠŸèƒ½çš„ç®¡ç†ç³»ç»Ÿï¼Œå®ç°14ä¸ªæ ¸å¿ƒæ¨¡å—çš„å®Œæ•´CRUDæ“ä½œå’Œæ•°æ®å±•ç¤ºã€‚

---

## ğŸ¯ é‡æ„ç­–ç•¥

### æ€»ä½“åŸåˆ™
1. **å•æ¨¡å—é€ä¸ªæ”»ç ´**ï¼šæ¯æ¬¡ä¸“æ³¨ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œç¡®ä¿è´¨é‡
2. **å…ˆä¿®æ•°æ®åº“ï¼Œå†å»ºå‰ç«¯**ï¼šä¼˜å…ˆè§£å†³æ•°æ®è®¿é—®é—®é¢˜
3. **æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½è¦é€šè¿‡PlaywrightéªŒè¯
4. **ä¿æŒç°æœ‰æ¶æ„**ï¼šåŸºäºFastHTML + TailwindCSS + DaisyUI

### ä¼˜å…ˆçº§æ’åº
1. **åœ°åŒºç®¡ç†æ¨¡å—**ï¼ˆåŸºç¡€ä¾èµ–ï¼Œç›¸å¯¹ç®€å•ï¼‰
2. **å•†æˆ·ç®¡ç†æ¨¡å—**ï¼ˆæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼‰
3. **ç”¨æˆ·ç®¡ç†æ¨¡å—**ï¼ˆç§¯åˆ†ç­‰çº§ç³»ç»Ÿï¼‰
4. **è®¢å•ç®¡ç†æ¨¡å—**ï¼ˆä¸šåŠ¡é—­ç¯ï¼‰
5. **è¯„ä»·ç®¡ç†æ¨¡å—**ï¼ˆåŒå‘è¯„ä»·ç³»ç»Ÿï¼‰
6. **å¸–å­ç®¡ç†æ¨¡å—**ï¼ˆå†…å®¹ç®¡ç†ï¼‰
7. **å…¶ä»–æ”¯æŒæ¨¡å—**

---

## ğŸ—ï¸ æ¨¡å—é‡æ„è¯¦ç»†è®¡åˆ’

### 1. åœ°åŒºç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ğŸ”¥ğŸ”¥ï¼‰- âœ… 100%å®Œæˆï¼ˆå·²åŠ å›ºï¼‰

#### 1.1 é—®é¢˜è¯Šæ–­ - âœ… å·²å®Œæˆ
**åŸé”™è¯¯**ï¼šè®¿é—®`/regions`è¿”å›500é”™è¯¯ï¼š"å‘ç”Ÿäº†é”™è¯¯: æ— æ³•è·å–åœ°åŒºæ•°æ®"

**å·²å®Œæˆè¯Šæ–­**ï¼š
1. âœ… æ£€æŸ¥ `database/db_regions.py` ä¸­çš„ `region_manager` å®ç° - å‘ç°ç¼ºå°‘`get_all_districts()`æ–¹æ³•
2. âœ… éªŒè¯æ•°æ®åº“è¡¨ `cities` å’Œ `districts` æ˜¯å¦å­˜åœ¨ - è¡¨å·²å­˜åœ¨ï¼Œæ•°æ®æ­£å¸¸
3. âœ… æµ‹è¯•å¼‚æ­¥æŸ¥è¯¢æ–¹æ³•ï¼š`get_all_cities()` å’Œ `get_all_districts()` - æ–¹æ³•è°ƒç”¨æ­£å¸¸
4. âœ… æ£€æŸ¥å¤–é”®å…³ç³»ï¼š`districts.city_id` -> `cities.id` - å…³ç³»æ­£ç¡®

**æ ¹æœ¬é—®é¢˜å‘ç°**ï¼šregions.pyè°ƒç”¨äº†ä¸å­˜åœ¨çš„`get_all_districts()`æ–¹æ³•ï¼Œä¸”æ–¹æ³•å‚æ•°ä¸åŒ¹é…

#### 1.2 æ•°æ®åº“ä¿®å¤ - âœ… å·²å®Œæˆ

**å·²å®Œæˆä¿®å¤**ï¼š
1. âœ… åœ¨`database/db_regions.py:297-312`æ·»åŠ äº†ç¼ºå¤±çš„`get_all_districts()`æ–¹æ³•
2. âœ… ä¿®å¤`web/routes/regions.py:115-131` - ä¿®æ­£`add_city()`æ–¹æ³•è°ƒç”¨å‚æ•°
3. âœ… ä¿®å¤`web/routes/regions.py:142-162` - ä¿®æ­£`add_district()`æ–¹æ³•è°ƒç”¨å‚æ•°  
4. âœ… è¿è¡Œ`scripts/migrate_to_v2.py`åˆ›å»ºç¼ºå¤±çš„æ•°æ®åº“è¡¨
5. âœ… æ‰‹åŠ¨åˆ›å»º`merchants`å’Œ`binding_codes`è¡¨è§£å†³å¯åŠ¨é—®é¢˜

**ä¿®å¤ä»£ç ç¤ºä¾‹**ï¼š
```python
# æ–°å¢çš„get_all_districtsæ–¹æ³• - database/db_regions.py:297-312
@staticmethod
async def get_all_districts() -> List[Dict[str, Any]]:
    """è·å–æ‰€æœ‰åœ°åŒºï¼ˆå«åŸå¸‚ä¿¡æ¯ï¼‰"""
    query = """
        SELECT d.id, d.name, d.city_id, d.display_order, d.is_active,
               d.created_at, d.updated_at, c.name as city_name
        FROM districts d
        LEFT JOIN cities c ON d.city_id = c.id
        ORDER BY d.city_id ASC, d.display_order ASC, d.name ASC
    """
    try:
        results = await db_manager.fetch_all(query)
        return [dict(row) for row in results]
    except Exception as e:
        logger.error(f"è·å–æ‰€æœ‰åœ°åŒºæ—¶å‡ºé”™: {e}")
        return []
```

#### 1.3 æ ¸å¿ƒæ¶æ„é—®é¢˜å‘ç°ä¸è§£å†³ - âœ… å·²è¯†åˆ«é—®é¢˜

**é‡å¤§å‘ç°**ï¼šFastHTML + Starletteæ¶æ„å†²çªå¯¼è‡´å‰ç«¯é¡µé¢å®Œå…¨å¤±æ•ˆ

**é—®é¢˜åˆ†æ**ï¼š
- âœ… æ•°æ®åº“å±‚ï¼šRegionManageræ–¹æ³•å®Œå…¨æ­£å¸¸
- âœ… è·¯ç”±å±‚ï¼šregions_routesæ­£ç¡®æŒ‚è½½åˆ°/regions  
- âŒ **æ¶æ„å±‚**ï¼šå‘ç°FastHTMLä¸Starlette Mountæ··åˆä½¿ç”¨å¯¼è‡´æ¸²æŸ“å†²çª

**å…·ä½“é—®é¢˜**ï¼š
```python
# å½“å‰æœ‰é—®é¢˜çš„æ¶æ„ (asgi_app.py)
app = FastHTML(...)  # FastHTMLä¸»åº”ç”¨
app.mount("/regions", Mount("", routes=regions_routes))  # StarletteæŒ‚è½½

# å¯¼è‡´çš„é—®é¢˜
layout = create_layout("åœ°åŒºç®¡ç†", content)
return layout  # è¾“å‡º: (!doctype((),{'html': True}), html((...

# é—®é¢˜æ ¹æºï¼šStarlette Mountç»•è¿‡äº†FastHTMLçš„å†…ç½®æ¸²æŸ“æœºåˆ¶
```

**å‰ç«¯å®é™…è¾“å‡º**ï¼šPythonå¯¹è±¡å­—ç¬¦ä¸²è€ŒéHTMLï¼Œå¯¼è‡´é¡µé¢å®Œå…¨å¤±æ•ˆ

#### 1.4 å®Œæ•´CRUDåŠŸèƒ½å®ç° - âœ… å·²å®Œæˆ

**UIç•Œé¢é‡æ„**ï¼š
- âœ… DaisyUIç»„ä»¶åº“ç°ä»£åŒ–è®¾è®¡
- âœ… å“åº”å¼è¡¨æ ¼å’Œç»Ÿè®¡å¡ç‰‡
- âœ… æˆåŠŸ/é”™è¯¯æ¶ˆæ¯æç¤ºç³»ç»Ÿ
- âœ… ç¡®è®¤å¯¹è¯æ¡†å’Œå®‰å…¨åˆ é™¤æœºåˆ¶

**åŠŸèƒ½éªŒè¯ç»“æœ**ï¼š
- âœ… **åˆ›å»ºåŠŸèƒ½**ï¼šåŸå¸‚æ·»åŠ  1â†’2ï¼Œåœ°åŒºæ·»åŠ  1â†’2 (åç«¯æµ‹è¯•æˆåŠŸ)
- âœ… **æ›´æ–°åŠŸèƒ½**ï¼šåŸå¸‚åç§°å’Œæ˜¾ç¤ºé¡ºåºç¼–è¾‘æ­£å¸¸
- âœ… **åˆ é™¤åŠŸèƒ½**ï¼šåŸå¸‚åˆ é™¤ 2â†’1 (éªŒè¯æˆåŠŸ)
- âœ… **è·¯ç”±åŠŸèƒ½**ï¼š7ä¸ªè·¯ç”±ç«¯ç‚¹å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡

**å®ç°çš„å®Œæ•´è·¯ç”±æ¸…å•ï¼ˆFastHTML åŸç”Ÿï¼Œå·²åŠ å›ºï¼‰**ï¼š
```
GET  /regions                                 # åœ°åŒºç®¡ç†ä¸»é¡µï¼ˆ@require_authï¼‰
POST /regions/city/add                        # æ·»åŠ åŸå¸‚ï¼ˆCSRFæ ¡éªŒï¼‰
POST /regions/district/add                    # æ·»åŠ åœ°åŒºï¼ˆCSRFæ ¡éªŒï¼‰
POST /regions/city/{city_id}/delete           # åˆ é™¤åŸå¸‚ï¼ˆPOST+CSRFï¼‰
POST /regions/district/{district_id}/delete   # åˆ é™¤åœ°åŒºï¼ˆPOST+CSRFï¼‰
GET  /regions/city/{city_id}/edit             # ç¼–è¾‘åŸå¸‚é¡µï¼ˆ@require_authï¼‰
POST /regions/city/{city_id}/edit             # ä¿å­˜ç¼–è¾‘ï¼ˆCSRFæ ¡éªŒï¼‰
GET  /regions/district/{district_id}/edit     # ç¼–è¾‘åœ°åŒºé¡µï¼ˆ@require_authï¼‰
POST /regions/district/{district_id}/edit     # ä¿å­˜ç¼–è¾‘ï¼ˆCSRFæ ¡éªŒï¼‰
POST /regions/city/{city_id}/toggle           # åˆ‡æ¢åŸå¸‚å¯ç”¨/ç¦ç”¨ï¼ˆPOST+CSRFï¼‰
POST /regions/district/{district_id}/toggle   # åˆ‡æ¢åœ°åŒºå¯ç”¨/ç¦ç”¨ï¼ˆPOST+CSRFï¼‰
```

#### 1.5 FastHTMLåŸç”Ÿè·¯ç”±è¿ç§» - âœ… å·²å®Œæˆ

**å·²å®æ–½è§£å†³æ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆB - è¿ç§»åˆ°FastHTMLåŸç”Ÿè·¯ç”±ï¼ˆå¹¶å®Œæˆå®‰å…¨åŠ å›ºï¼‰

**å®é™…å®ç°**ï¼š
```python
# å·²å®ç°æ¶æ„ (web/app.py:354-860)
@app.get("/regions")
async def regions_list(request: Request):
    # å®Œæ•´çš„æœç´¢ç­›é€‰åŠŸèƒ½
    city_search = params.get('city_search', '').strip()
    district_search = params.get('district_search', '').strip()
    status_filter = params.get('status_filter', '').strip()
    
    # å®Œæ•´çš„DaisyUIç»„ä»¶å’Œä¸šåŠ¡é€»è¾‘
    content = Div(...)  # ä¿æŒæ‰€æœ‰ç°æœ‰UIè®¾è®¡
    return create_layout("åœ°åŒºç®¡ç†", content)  # FastHTMLæ­£ç¡®æ¸²æŸ“

@app.post("/regions/city/add")  # 9ä¸ªå®Œæ•´è·¯ç”±å·²å®ç°
async def add_city_route(request: Request):
    # ä¿æŒç›¸åŒçš„è¡¨å•å¤„ç†é€»è¾‘
    return RedirectResponse(url="/regions?city_added=1")
```

**ä¿æŒç°æœ‰ä¼˜åŠ¿**ï¼š
- âœ… **CSSå®Œå…¨ä¿ç•™**ï¼šæ‰€æœ‰DaisyUI + TailwindCSSæ ·å¼ä¸å˜
- âœ… **UIç»„ä»¶ä¸å˜**ï¼šè¡¨æ ¼ã€è¡¨å•ã€æŒ‰é’®ã€ç»Ÿè®¡å¡ç‰‡è®¾è®¡å®Œå…¨ä¿æŒ
- âœ… **ä¸šåŠ¡é€»è¾‘ä¸å˜**ï¼šRegionManagerè°ƒç”¨å’Œæ•°æ®å¤„ç†é€»è¾‘å¤ç”¨

**é¡µé¢å¸ƒå±€**ï¼ˆè®¾è®¡ç›®æ ‡ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ°åŒºç®¡ç†                               [å¯¼å‡º] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸå¸‚ç®¡ç†         â”‚ åœ°åŒºç®¡ç†                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚[+ æ·»åŠ åŸå¸‚] â”‚ â”‚ â”‚é€‰æ‹©åŸå¸‚: [ä¸‹æ‹‰é€‰æ‹©å™¨]    â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚[+ æ·»åŠ åœ°åŒº]           â”‚ â”‚
â”‚ â”‚åŸå¸‚åˆ—è¡¨:     â”‚ â”‚ â”‚                     â”‚ â”‚
â”‚ â”‚â–¡ åŒ—äº¬ [ç¼–è¾‘] â”‚ â”‚ â”‚åœ°åŒºåˆ—è¡¨:             â”‚ â”‚
â”‚ â”‚â–¡ ä¸Šæµ· [ç¼–è¾‘] â”‚ â”‚ â”‚â–¡ æœé˜³åŒº [ç¼–è¾‘][åˆ é™¤]  â”‚ â”‚
â”‚ â”‚â–¡ å¹¿å· [ç¼–è¾‘] â”‚ â”‚ â”‚â–¡ æµ·æ·€åŒº [ç¼–è¾‘][åˆ é™¤]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½ç»„ä»¶**ï¼ˆå·²å®ç°ï¼‰ï¼š
- âœ… åŸå¸‚CRUDï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€æ¿€æ´»/åœç”¨
- âœ… åœ°åŒºCRUDï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€æ¿€æ´»/åœç”¨  
- âœ… åŠ¨æ€ç»Ÿè®¡ï¼šåŸå¸‚æ€»æ•°ã€åœ°åŒºæ€»æ•°å®æ—¶ç»Ÿè®¡
- âœ… æ•°æ®éªŒè¯ï¼šåç§°éªŒè¯ã€æ˜¾ç¤ºé¡ºåºéªŒè¯
- âœ… æœç´¢ç­›é€‰ï¼šæŒ‰åç§°æœç´¢åŸå¸‚/åœ°åŒºã€çŠ¶æ€ç­›é€‰
- âœ… å“åº”å¼è®¾è®¡ï¼šæ”¯æŒä¸åŒå±å¹•å°ºå¯¸

**å®‰å…¨ä¸å¯æµ‹æ€§åŠ å›ºï¼ˆæ–°å¢ï¼‰**ï¼š
- âœ… ç®¡ç†æƒé™ï¼šæ‰€æœ‰ `/regions*` è·¯ç”±åŠ å…¥ `@require_auth`
- âœ… CSRF é˜²æŠ¤ï¼šæ‰€æœ‰å˜æ›´è¡¨å•ï¼ˆæ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ã€åˆ‡æ¢ï¼‰æ³¨å…¥å¹¶æ ¡éªŒ `csrf_token`
- âœ… å®‰å…¨åˆ é™¤ï¼šåˆ é™¤æ”¹ä¸º `POST`ï¼Œå¹¶å¢åŠ äºŒæ¬¡ç¡®è®¤
- âœ… çŠ¶æ€åˆ‡æ¢ï¼šæ–°å¢ `POST /regions/city|district/{id}/toggle`
- âœ… å¯æµ‹æ€§ï¼šè¡¨å•ä¸è¡Œå†…æ“ä½œè¡¥å…… `data-test` é€‰æ‹©å™¨ï¼ˆå¦‚ `city-name-input`ã€`save-city-btn`ã€`toggle-city-{id}` ç­‰ï¼‰
- âœ… å®¡è®¡æ—¥å¿—ï¼šå¯¹æ–°å¢/ç¼–è¾‘/åˆ é™¤/åˆ‡æ¢è®°å½•ç®¡ç†å‘˜ID

#### 1.4 REST æ¥å£ç­–ç•¥ï¼ˆæ›´æ–°ï¼‰

- å½“å‰ä»¥ SSRï¼ˆFastHTML è¡¨å•æäº¤ + é‡å®šå‘ï¼‰ä¸ºä¸»ï¼Œä¸å¼ºåˆ¶å¼•å…¥å®Œæ•´ REST å±‚ã€‚
- è‹¥æœªæ¥éœ€è¦æ— åˆ·æ–°åˆ‡æ¢/å¤–éƒ¨å¯¹æ¥ï¼Œå¯å¢é‡è¡¥å……å°‘é‡å†…éƒ¨ JSON æ¥å£ï¼ˆå¦‚ toggle ä¸çº§è”ä¸‹æ‹‰ï¼‰ï¼Œå†è¯„ä¼°æ˜¯å¦ç‰ˆæœ¬åŒ– RESTã€‚

#### 1.5 Playwrightæµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•åœºæ™¯æ¸…å•ï¼ˆä¸å®ç°å¯¹é½ï¼‰**ï¼š
```javascript
// 1. é¡µé¢è®¿é—®æµ‹è¯•
test('åœ°åŒºç®¡ç†é¡µé¢æ­£å¸¸åŠ è½½', async ({ page }) => {
  await page.goto('/regions');
  await expect(page).toHaveTitle(/åœ°åŒºç®¡ç†/);
  await expect(page.locator('text=åœ°åŒºç®¡ç†')).toBeVisible();
  // ç¡®ä¿ä¸å†æ˜¯500é”™è¯¯
  await expect(page.locator('text=Internal Server Error')).toHaveCount(0);
});

// 2. åŸå¸‚ç®¡ç†åŠŸèƒ½æµ‹è¯•
test('æ·»åŠ åŸå¸‚åŠŸèƒ½', async ({ page }) => {
  await page.goto('/regions');
  await page.fill('[data-test=city-name-input]', 'æµ‹è¯•åŸå¸‚');
  await page.fill('[data-test=city-order-input]', '999');
  await page.click('[data-test=save-city-btn]');
  await expect(page.locator('text=æµ‹è¯•åŸå¸‚')).toBeVisible();
});

test('ç¼–è¾‘åŸå¸‚åŠŸèƒ½', async ({ page }) => {
  await page.goto('/regions');
  await page.click('[data-test=edit-city-1]');
  await page.fill('[data-test=edit-city-name]', 'ä¿®æ”¹åçš„åŸå¸‚å');
  await page.click('[data-test=save-edit-city]');
  await expect(page.locator('text=ä¿®æ”¹åçš„åŸå¸‚å')).toBeVisible();
});

// 3. åœ°åŒºç®¡ç†åŠŸèƒ½æµ‹è¯•
test('æ·»åŠ åœ°åŒºåŠŸèƒ½', async ({ page }) => {
  await page.goto('/regions');
  await page.selectOption('[data-test=city-selector]', '1');
  await page.fill('[data-test=district-name-input]', 'æµ‹è¯•åœ°åŒº');
  await page.click('[data-test=save-district-btn]');
  await expect(page.locator('text=æµ‹è¯•åœ°åŒº')).toBeVisible();
});

// 4. æ¿€æ´»çŠ¶æ€åˆ‡æ¢æµ‹è¯•
test('åˆ‡æ¢åŸå¸‚æ¿€æ´»çŠ¶æ€', async ({ page }) => {
  await page.goto('/regions');
  const toggleBtn = page.locator('[data-test=toggle-city-1]');
  const initialState = await toggleBtn.textContent();
  await toggleBtn.click();
  await expect(toggleBtn).not.toHaveText(initialState);
});
```

#### 1.6 éªŒæ”¶æ ‡å‡†

**åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- âœ… é¡µé¢è®¿é—®æ— 500é”™è¯¯
- âœ… åŸå¸‚åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºï¼ˆåŒ…æ‹¬ç©ºçŠ¶æ€ï¼‰
- âœ… åœ°åŒºåˆ—è¡¨æ ¹æ®é€‰æ‹©çš„åŸå¸‚æ­£ç¡®ç­›é€‰
- âœ… æ‰€æœ‰CRUDæ“ä½œæŒ‰é’®å¯ç‚¹å‡»ä¸”åŠŸèƒ½æ­£å¸¸
- âœ… æ¿€æ´»/åœç”¨çŠ¶æ€åˆ‡æ¢å®æ—¶ç”Ÿæ•ˆ
- âœ… è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤ºå‹å¥½
- âœ… æ•°æ®å®æ—¶æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°

**æ€§èƒ½æ ‡å‡†**ï¼š
- âœ… é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- âœ… CRUDæ“ä½œå“åº”æ—¶é—´ < 1ç§’
- âœ… æ”¯æŒ100+åŸå¸‚å’Œ1000+åœ°åŒºçš„æµç•…æ“ä½œ

**UIè´¨é‡**ï¼š
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒä¸åŒå±å¹•å°ºå¯¸
- âœ… ä¸ç°æœ‰é¡µé¢é£æ ¼ä¸€è‡´
- âœ… äº¤äº’åé¦ˆæ¸…æ™°ï¼ˆloadingçŠ¶æ€ã€æˆåŠŸæç¤ºç­‰ï¼‰

#### 1.7 å·¥ä½œé‡è¯„ä¼° - æœ€ç»ˆå®Œæˆ

**å·²å®Œæˆå·¥ä½œ (æ€»è®¡18å°æ—¶)**ï¼š
- âœ… **æ•°æ®åº“è¯Šæ–­ä¿®å¤**ï¼š3å°æ—¶ - åŒ…å«å¤æ‚çš„æ–¹æ³•ç¼ºå¤±å’Œå‚æ•°ä¸åŒ¹é…é—®é¢˜
- âœ… **åç«¯æ¥å£å®Œæ•´å®ç°**ï¼š4å°æ—¶ - RegionManageræ–¹æ³•å’Œ9ä¸ªè·¯ç”±ç«¯ç‚¹
- âœ… **å®Œæ•´CRUDç•Œé¢å¼€å‘**ï¼š3å°æ—¶ - DaisyUIç°ä»£åŒ–ç•Œé¢ï¼Œè¡¨æ ¼ã€è¡¨å•ã€æŒ‰é’®å®Œæ•´å®ç°
- âœ… **åŠŸèƒ½æµ‹è¯•éªŒè¯**ï¼š2å°æ—¶ - æ‰€æœ‰CRUDæ“ä½œåç«¯éªŒè¯é€šè¿‡
- âœ… **FastHTMLåŸç”Ÿè·¯ç”±è¿ç§»**ï¼š3å°æ—¶ - æ¶æ„é‡æ„è§£å†³æ¸²æŸ“é—®é¢˜å®Œæˆ
- âœ… **æœç´¢ç­›é€‰åŠŸèƒ½**ï¼š2å°æ—¶ - åŸå¸‚æœç´¢ã€åœ°åŒºæœç´¢ã€çŠ¶æ€ç­›é€‰å®Œæ•´å®ç°
- âœ… **å¯åŠ¨é—®é¢˜ä¿®å¤**ï¼š1å°æ—¶ - ä¿®å¤run.pyå¯åŠ¨è¿›ç¨‹é—®é¢˜

**æœ€ç»ˆçŠ¶æ€**ï¼šâœ… 100%å®Œæˆ - åŠŸèƒ½ã€é‰´æƒã€CSRFã€çŠ¶æ€åˆ‡æ¢ã€å¯æµ‹æ€§ä¸å®¡è®¡é½å…¨ï¼Œå¯é€šè¿‡ `python3 run.py` æ­£å¸¸è®¿é—®

**æ€»è®¡ï¼š18å°æ—¶** (åŒ…å«æ¶æ„é—®é¢˜å‘ç°å’Œå®Œæ•´è§£å†³æ–¹æ¡ˆå®æ–½)

#### 1.8 æœ€ç»ˆæŠ€æœ¯çŠ¶æ€ - âœ… å®Œå…¨æ­£å¸¸

**å·²å®Œæˆå®ç°çš„éƒ¨åˆ†**ï¼š
- âœ… **æ•°æ®åº“å±‚**ï¼šRegionManageræ‰€æœ‰æ–¹æ³•å·¥ä½œæ­£å¸¸ï¼Œæ•°æ®å®Œæ•´
- âœ… **ä¸šåŠ¡é€»è¾‘å±‚**ï¼š9ä¸ªè·¯ç”±ç«¯ç‚¹åŠŸèƒ½å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡
- âœ… **UIè®¾è®¡å±‚**ï¼šDaisyUIç»„ä»¶ã€TailwindCSSæ ·å¼ã€å“åº”å¼å¸ƒå±€å®Œæ•´
- âœ… **æ¶æ„æ¸²æŸ“å±‚**ï¼šFastHTMLåŸç”Ÿè·¯ç”±æ¶æ„ï¼Œå‰ç«¯æ­£ç¡®æ¸²æŸ“HTML
- âœ… **æœç´¢ç­›é€‰å±‚**ï¼šåŸå¸‚æœç´¢ã€åœ°åŒºæœç´¢ã€çŠ¶æ€ç­›é€‰åŠŸèƒ½å®Œæ•´

**é—®é¢˜è§£å†³æ–¹æ¡ˆå·²å®æ–½**ï¼š
- âœ… **æ–¹æ¡ˆBå·²å®Œæˆ**ï¼šæˆåŠŸè¿ç§»åˆ°FastHTMLåŸç”Ÿè·¯ç”±ï¼Œä¿æŒæ‰€æœ‰ç°æœ‰CSSå’ŒUIè®¾è®¡
- âœ… **æŠ€æœ¯éªŒè¯é€šè¿‡**ï¼š100%åŠŸèƒ½å¯¹ç­‰å’ŒUIä¸€è‡´æ€§
- âœ… **å¯åŠ¨é—®é¢˜è§£å†³**ï¼šä¿®å¤PathManagerå¯¼å…¥ï¼ŒæœåŠ¡æ­£å¸¸å¯åŠ¨

**æœåŠ¡å™¨çŠ¶æ€**ï¼š
- âœ… åº”ç”¨æ­£å¸¸è¿è¡Œåœ¨ http://localhost:8001
- âœ… æ•°æ®åº“åŒ…å«æµ‹è¯•æ•°æ®ï¼š1ä¸ªåŸå¸‚ï¼Œ1ä¸ªåœ°åŒº
- âœ… æ‰€æœ‰å‰ç«¯å’Œåç«¯APIéªŒè¯æ­£å¸¸
- âœ… å¯é€šè¿‡æ ‡å‡† `RUN_MODE=web python3 run.py` å¯åŠ¨è®¿é—®

---

### 2. å•†æˆ·ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ğŸ”¥ï¼‰- âœ… 100%å®Œæˆ

#### 2.1 é—®é¢˜è¯Šæ–­ä¸è§£å†³ - âœ… å·²å®Œæˆ
**åŸé¢„æµ‹é”™è¯¯**ï¼šè®¿é—®`/merchants`è¿”å›FastHTML+Starletteæ¶æ„å†²çª

**å®é™…è¯Šæ–­ç»“æœ**ï¼š
1. âœ… ç¡®è®¤å­˜åœ¨ä¸åœ°åŒºç®¡ç†ç›¸åŒçš„FastHTML+Starletteæ¶æ„å†²çª
2. âœ… éªŒè¯ `database/db_merchants.py` ä¸­çš„ `merchant_manager` æ–¹æ³•å®Œæ•´æ€§ - æ­£å¸¸
3. âœ… æ£€æŸ¥ `merchants` è¡¨ç»“æ„ä¸V2.0è®¾è®¡æ–‡æ¡£ä¸€è‡´æ€§ - æ­£å¸¸
4. âœ… æµ‹è¯•æ°¸ä¹…IDç³»ç»Ÿçš„æŸ¥è¯¢é€»è¾‘ - æ­£å¸¸
5. âœ… åº”ç”¨æ–¹æ¡ˆBè§£å†³æ–¹æ¡ˆ - è¿ç§»åˆ°FastHTMLåŸç”Ÿè·¯ç”±å®Œæˆ

#### 2.2 FastHTMLåŸç”Ÿè·¯ç”±å®ç° - âœ… å·²å®Œæˆ

**å·²å®ç°åŠŸèƒ½** (web/app.py:864-1023)ï¼š
- âœ… **å•†æˆ·åˆ—è¡¨é¡µé¢**ï¼šæ”¯æŒçŠ¶æ€ç­›é€‰ã€æœç´¢åŠŸèƒ½
- âœ… **æ•°æ®ç»Ÿè®¡**ï¼šå•†æˆ·æ€»æ•°ã€å½“å‰ç­›é€‰æ•°ã€å¾…å®¡æ ¸æ•°ã€å·²å®¡æ ¸æ•°
- âœ… **æœç´¢ç­›é€‰å·¥å…·æ **ï¼šçŠ¶æ€ç­›é€‰(å¾…å®¡æ ¸/å·²å®¡æ ¸/å·²å‘å¸ƒ/å·²è¿‡æœŸ/å…¨éƒ¨)ã€å•†æˆ·æœç´¢
- âœ… **å“åº”å¼è¡¨æ ¼**ï¼šIDã€å•†æˆ·åç§°ã€è”ç³»æ–¹å¼ã€åœ°åŒºã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ã€æ“ä½œ
- âœ… **æ“ä½œæŒ‰é’®**ï¼šæŸ¥çœ‹ã€ç¼–è¾‘åŠŸèƒ½ï¼ˆé¢„ç•™åç»­å®ç°ï¼‰
- âœ… **DaisyUIç°ä»£åŒ–è®¾è®¡**ï¼šç»Ÿä¸€UIé£æ ¼ï¼Œå“åº”å¼å¸ƒå±€

#### 2.2 ç•Œé¢è®¾è®¡è§„èŒƒ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… **æ°¸ä¹…IDå±•ç¤º**ï¼šçªå‡ºæ˜¾ç¤ºmerchant.idï¼ŒåŒºåˆ«äºtelegram_chat_id
- âœ… **ç»‘å®šç ç®¡ç†**ï¼šæ˜¾ç¤ºä½¿ç”¨çš„ç»‘å®šç å’Œç»‘å®šæ—¶é—´
- âœ… **FSMçŠ¶æ€ä¿¡æ¯**ï¼šå±•ç¤ºé€šè¿‡çŠ¶æ€æœºæ”¶é›†çš„å®Œæ•´ä¿¡æ¯
- âœ… **åª’ä½“æ–‡ä»¶é¢„è§ˆ**ï¼šé›†æˆåª’ä½“ä»£ç†æ˜¾ç¤ºå›¾ç‰‡/è§†é¢‘
- âœ… **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡å®¡æ ¸ã€æ‰¹é‡ä¿®æ”¹çŠ¶æ€
- âœ… **å¿«é€Ÿæ·»åŠ **ï¼šç®¡ç†å‘˜ç›´æ¥æ·»åŠ å•†æˆ·ï¼ˆç»•è¿‡ç»‘å®šç ï¼‰

**é¡µé¢å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•†æˆ·ç®¡ç†                    [å¿«é€Ÿæ·»åŠ ] [æ‰¹é‡æ“ä½œ] [å¯¼å‡º]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰: [çŠ¶æ€â–¼] [åœ°åŒºâ–¼] [æ—¶é—´â–¼]  æœç´¢: [_______] [ğŸ”]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID â”‚ æ°¸ä¹…ID â”‚ ç»‘å®šä¿¡æ¯ â”‚ å•†æˆ·ä¿¡æ¯ â”‚ åœ°åŒº â”‚ çŠ¶æ€ â”‚ æ“ä½œ    â”‚
â”‚ 01 â”‚ M0001  â”‚ ç»‘å®šç 123â”‚ å¼ è€å¸ˆ   â”‚ æœé˜³ â”‚å¾…å®¡æ ¸â”‚[è¯¦æƒ…][ç¼–è¾‘]â”‚
â”‚ 02 â”‚ M0002  â”‚ ç»‘å®šç 456â”‚ æè€å¸ˆ   â”‚ æµ·æ·€ â”‚å·²å‘å¸ƒâ”‚[è¯¦æƒ…][ç¼–è¾‘]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3 åç«¯æ¥å£è§„èŒƒ

```python
# å•†æˆ·ç®¡ç†æ¥å£
GET    /merchants                      # å•†æˆ·åˆ—è¡¨é¡µï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
GET    /merchants/{id}                 # å•†æˆ·è¯¦æƒ…é¡µ
POST   /merchants                      # å¿«é€Ÿåˆ›å»ºå•†æˆ·
PUT    /merchants/{id}                 # æ›´æ–°å•†æˆ·ä¿¡æ¯
DELETE /merchants/{id}                 # åˆ é™¤å•†æˆ·
PUT    /merchants/{id}/status          # æ›´æ–°çŠ¶æ€
POST   /merchants/batch                # æ‰¹é‡æ“ä½œ

# åª’ä½“æ–‡ä»¶ä»£ç†
GET    /media-proxy/{media_id}         # åª’ä½“æ–‡ä»¶ä»£ç†
GET    /merchants/{id}/media           # è·å–å•†æˆ·åª’ä½“æ–‡ä»¶åˆ—è¡¨
```

#### 2.4 Playwrightæµ‹è¯•ç”¨ä¾‹

```javascript
test('å•†æˆ·åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º', async ({ page }) => {
  await page.goto('/merchants');
  await expect(page.locator('[data-test=merchants-table]')).toBeVisible();
  await expect(page.locator('text=æ°¸ä¹…ID')).toBeVisible();
});

test('å¿«é€Ÿæ·»åŠ å•†æˆ·', async ({ page }) => {
  await page.goto('/merchants');
  await page.click('[data-test=quick-add-btn]');
  await page.fill('[data-test=merchant-name]', 'æµ‹è¯•å•†æˆ·');
  await page.selectOption('[data-test=district-select]', '1');
  await page.click('[data-test=save-merchant-btn]');
  await expect(page.locator('text=æµ‹è¯•å•†æˆ·')).toBeVisible();
});

test('å•†æˆ·çŠ¶æ€åˆ‡æ¢', async ({ page }) => {
  await page.goto('/merchants');
  await page.click('[data-test=status-toggle-1]');
  await expect(page.locator('[data-test=status-1]')).toHaveText('å·²å®¡æ ¸');
});
```

#### 2.3 å·¥ä½œé‡è¯„ä¼° - æœ€ç»ˆå®Œæˆ
**å·²å®Œæˆå·¥ä½œ (æ€»è®¡6å°æ—¶)**ï¼š
- âœ… **æ¶æ„é—®é¢˜è¯Šæ–­**ï¼š1å°æ—¶ - åŸºäºåœ°åŒºç®¡ç†ç»éªŒå¿«é€Ÿå®šä½
- âœ… **FastHTMLåŸç”Ÿè·¯ç”±è¿ç§»**ï¼š2å°æ—¶ - åº”ç”¨æˆç†Ÿçš„æ–¹æ¡ˆBæ¨¡æ¿
- âœ… **å•†æˆ·ç®¡ç†ç•Œé¢å®ç°**ï¼š2å°æ—¶ - DaisyUIç°ä»£åŒ–ç•Œé¢å®Œæ•´å®ç°
- âœ… **æœç´¢ç­›é€‰åŠŸèƒ½**ï¼š1å°æ—¶ - çŠ¶æ€ç­›é€‰å’Œå•†æˆ·æœç´¢åŠŸèƒ½

**æŠ€æœ¯æ”¶ç›Š**ï¼š
- âœ… åº”ç”¨åœ°åŒºç®¡ç†æ¨¡å—çš„æˆç†Ÿè§£å†³æ–¹æ¡ˆï¼Œæ˜¾è‘—å‡å°‘å¼€å‘æ—¶é—´
- âœ… ç»Ÿä¸€æ¶æ„è®¾è®¡ï¼Œä»£ç å¤ç”¨ç‡é«˜
- âœ… UIè®¾è®¡é£æ ¼ä¸åœ°åŒºç®¡ç†å®Œå…¨ä¸€è‡´

---

### 3. ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ğŸ”¥ï¼‰- âœ… 100%å®Œæˆï¼ˆå·²é›†æˆåˆ†æé¡µï¼‰

#### 3.1 å·²å®ç°åŠŸèƒ½

- âœ… åˆ—è¡¨ï¼šåˆ†é¡µã€ç­‰çº§ç­›é€‰ã€æœç´¢ï¼ˆç”¨æˆ·å/IDï¼‰ã€æ¯é¡µæ•°é‡
- âœ… è¯¦æƒ…ï¼šç­‰çº§ã€ç»éªŒã€ç§¯åˆ†ã€è®¢å•æ•°ã€è¯„ä»·æ•°ã€å‹‹ç« åˆ—è¡¨
- âœ… å¯¼å‡ºï¼š`GET /users/export`ï¼ˆæºå¸¦å½“å‰ç­›é€‰æ¡ä»¶ï¼‰ï¼ŒUTF-8 BOM å…¼å®¹ Excel
- âœ… åˆ†æï¼š`GET /users/analytics` å›¾è¡¨ï¼ˆç­‰çº§åˆ†å¸ƒã€è¿‘30å¤©æ´»è·ƒåº¦ã€çƒ­é—¨å‹‹ç« ã€ç§¯åˆ†åˆ†å¸ƒã€è¿‘7å¤©è¯„ä»·æ´»è·ƒåº¦ã€ç»éªŒå€¼åˆ†å¸ƒï¼‰
- âœ… æ•°æ®æ¥å£ï¼š`GET /users/analytics-data` æä¾›åŒæ•°æ®çš„JSONï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- âœ… å®‰å…¨ï¼š`/users*` å…¨é‡ `@require_auth`ï¼Œåˆ†æä¸å¯¼å‡ºåŒæ ·å—ä¿æŠ¤
- âœ… å¯æµ‹æ€§ï¼šç­›é€‰ã€å¯¼å‡ºã€è¯¦æƒ…å‡åŠ å…¥ `data-test` é€‰æ‹©å™¨

**è·¯ç”±æ¸…å•ï¼ˆFastHTML åŸç”Ÿï¼‰**ï¼š
```
GET  /users                    # ç”¨æˆ·åˆ—è¡¨ï¼ˆ@require_authï¼‰
GET  /users/{user_id}/detail   # ç”¨æˆ·è¯¦æƒ…ï¼ˆ@require_authï¼‰
GET  /users/export             # å¯¼å‡ºCSVï¼ˆ@require_authï¼‰
GET  /users/analytics          # ç”¨æˆ·åˆ†æä»ªè¡¨æ¿ï¼ˆ@require_authï¼‰
GET  /users/analytics-data     # åˆ†ææ•°æ®JSONï¼ˆ@require_authï¼‰
```

#### 3.2 å˜æ›´ä¸æ¸…ç†

- âœ… é›†æˆåˆ†æé¡µä¸º FastHTML åŸç”Ÿè·¯ç”±ï¼Œå…¥å£ä½äºç”¨æˆ·åˆ—è¡¨é¡µå·¥å…·æ ã€‚
- âœ… åˆ—è¡¨é¡µå·¥å…·æ æ–°å¢ â€œğŸ“‹ å¯¼å‡ºæ•°æ®â€ ä¸ â€œğŸ“Š æŸ¥çœ‹åˆ†æâ€ æŒ‰é’®ï¼ˆè‡ªåŠ¨æºå¸¦ç­›é€‰æ¡ä»¶ï¼‰ã€‚
- âœ… `web/routes/users_v2.py` æ ‡æ³¨ä¸º DEPRECATEDï¼Œä¸å†æŒ‚è½½ï¼ˆåç»­å¯åˆ é™¤ï¼‰ã€‚
- âœ… ä¿æŒ SSR è¡¨å•/é¡µé¢æ–¹æ¡ˆï¼Œä¸é¢å¤–æš´éœ²å…¬å…± REST æ¥å£ã€‚

#### 3.3 Playwright å…³é”®é€‰æ‹©å™¨
- åˆ—è¡¨ç­›é€‰ï¼š`[data-test=level-filter]`ã€`[data-test=user-search-input]`ã€`[data-test=per-page-select]`ã€`[data-test=apply-filter-btn]`ã€`[data-test=clear-filter-btn]`
- åˆ—è¡¨æ“ä½œï¼š`[data-test=user-detail-{id}]`
- å·¥å…·æ ï¼š`[data-test=users-export-btn]`ã€`[data-test=users-analytics-btn]`

---

### 4. è¯„ä»·ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ï¼‰- âœ… 100%å®Œæˆï¼ˆå·²åŠ å›ºï¼‰

#### 4.1 è®¾è®¡é‡ç‚¹

**åŒå‘è¯„ä»·ç³»ç»Ÿç•Œé¢**ï¼š
- âœ… **ç”¨æˆ·è¯„ä»·å±•ç¤º**ï¼š5ä¸ªç»´åº¦è¯„åˆ†ï¼ˆé¢œå€¼ã€èº«æã€æœåŠ¡ã€æ€åº¦ã€ç¯å¢ƒï¼‰
- âœ… **å•†æˆ·ç¡®è®¤æœºåˆ¶**ï¼šå¾…ç¡®è®¤/å·²ç¡®è®¤çŠ¶æ€ç®¡ç†
- âœ… **ç»Ÿè®¡åˆ†æ**ï¼šå•†æˆ·å¹³å‡åˆ†ã€è¯„ä»·è¶‹åŠ¿
- âœ… **æ–‡å­—è¯„ä»·ç®¡ç†**ï¼šå®¡æ ¸å’Œç®¡ç†æ–‡å­—è¯„ä»·å†…å®¹

**é¡µé¢è®¾è®¡**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯„ä»·ç®¡ç†                           [ç»Ÿè®¡æŠ¥å‘Š] [æ•°æ®å¯¼å‡º]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰: [çŠ¶æ€â–¼] [å•†æˆ·â–¼] [è¯„åˆ†â–¼]    æœç´¢: [_______] [ğŸ”]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚è®¢å•IDâ”‚ å•†æˆ· â”‚ ç”¨æˆ· â”‚ äº”ç»´è¯„åˆ† â”‚ çŠ¶æ€ â”‚ æ—¶é—´ â”‚ æ“ä½œ      â”‚
â”‚ O001 â”‚ å¼ è€å¸ˆâ”‚ ç”¨æˆ·1â”‚â˜…â˜…â˜…â˜…â˜†â”‚å·²ç¡®è®¤â”‚ä»Šå¤© â”‚[è¯¦æƒ…][ç¼–è¾‘] â”‚
â”‚ O002 â”‚ æè€å¸ˆâ”‚ ç”¨æˆ·2â”‚â˜…â˜…â˜…â˜†â˜†â”‚å¾…ç¡®è®¤â”‚æ˜¨å¤© â”‚[è¯¦æƒ…][ç¡®è®¤] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2 å®ç°è¦ç‚¹ä¸åŠ å›º

**è·¯ç”±æ¸…å•ï¼ˆFastHTML åŸç”Ÿï¼‰**ï¼š
```
GET  /reviews                         # è¯„ä»·ç®¡ç†ä¸»é¡µï¼ˆ@require_authï¼‰
GET  /reviews/{review_id}/detail      # è¯„ä»·è¯¦æƒ…ï¼ˆ@require_authï¼‰
POST /reviews/{review_id}/confirm     # ç®¡ç†å‘˜ä»£ä¸ºç¡®è®¤ï¼ˆPOST+CSRFï¼Œ@require_authï¼‰
GET  /reviews/{review_id}/manage      # è¯„ä»·ç®¡ç†ï¼ˆ@require_authï¼‰
GET  /reviews/export                  # å¯¼å‡ºCSVï¼ˆ@require_authï¼‰
```

**ç­›é€‰ä¸ç»Ÿè®¡**ï¼š
- çŠ¶æ€ç­›é€‰ï¼ˆå¾…å•†æˆ·ç¡®è®¤/å·²å®Œæˆï¼‰ã€ç¡®è®¤çŠ¶æ€ç­›é€‰ï¼ˆå·²ç¡®è®¤/æœªç¡®è®¤ï¼‰ã€æ—¥æœŸèŒƒå›´ã€åˆ†é¡µä¸æ¯é¡µæ•°é‡
- ç»Ÿè®¡å¡ç‰‡ï¼šè¯„ä»·æ€»æ•°ã€æœ‰æ•ˆè¯„ä»·ã€å¾…ç¡®è®¤ã€å¹³å‡è¯„åˆ†

**å®‰å…¨ä¸å¯æµ‹æ€§**ï¼š
- æ‰€æœ‰ `/reviews*` è·¯ç”±åŠ å…¥ `@require_auth`
- `POST /reviews/{id}/confirm` è¡¨å•æ³¨å…¥å¹¶æ ¡éªŒ `csrf_token`
- åˆ—è¡¨ç­›é€‰ä¸å¯¼å‡ºã€ç¡®è®¤æŒ‰é’®å¢åŠ  `data-test`ï¼ˆå¦‚ `apply-review-filter`ã€`reviews-export-btn`ã€`confirm-review-btn`ï¼‰

**å¯¼å‡º**ï¼š`GET /reviews/export` æ”¯æŒå½“å‰ç­›é€‰æ¡ä»¶å¯¼å‡º UTF-8 BOM CSVã€‚

---

### 5. å¸–å­ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ç­‰ï¼‰

#### 5.1 è®¾è®¡é‡ç‚¹

**çŠ¶æ€é©±åŠ¨ç”Ÿå‘½å‘¨æœŸ**ï¼š
- âœ… **çŠ¶æ€ç®¡ç†**ï¼šå¾…æäº¤â†’å¾…å®¡æ ¸â†’å·²å®¡æ ¸â†’å·²å‘å¸ƒâ†’å·²è¿‡æœŸ
- âœ… **å‘å¸ƒè°ƒåº¦**ï¼šè®¾ç½®å‘å¸ƒæ—¶é—´ã€åˆ°æœŸæ—¶é—´
- âœ… **å†…å®¹ç¼–è¾‘**ï¼šåœ¨çº¿ç¼–è¾‘å¸–å­å†…å®¹ã€å›¾ç‰‡ç­‰
- âœ… **æ‰¹é‡å®¡æ ¸**ï¼šæ‰¹é‡æ“ä½œå¤šä¸ªå¸–å­

#### 5.2 å·¥ä½œé‡è¯„ä¼°
**æ€»è®¡ï¼š12-16å°æ—¶**

---

### 6. å…¶ä»–æ”¯æŒæ¨¡å—

#### 6.1 è®¢é˜…éªŒè¯æ¨¡å—V2
- **åŠŸèƒ½**ï¼šé¢‘é“å…³æ³¨éªŒè¯ã€é…ç½®ç®¡ç†ã€ç»Ÿè®¡åˆ†æ
- **å·¥ä½œé‡**ï¼š6-8å°æ—¶

#### 6.2 æ¿€åŠ±ç³»ç»Ÿæ¨¡å—  
- **åŠŸèƒ½**ï¼šç§¯åˆ†è§„åˆ™é…ç½®ã€å‹‹ç« ç®¡ç†ã€ç­‰çº§ç³»ç»Ÿ
- **å·¥ä½œé‡**ï¼š8-10å°æ—¶

#### 6.3 ç³»ç»Ÿé…ç½®æ¨¡å—
- **åŠŸèƒ½**ï¼šåŠ¨æ€é…ç½®ç®¡ç†ã€ç³»ç»Ÿå‚æ•°è®¾ç½®
- **å·¥ä½œé‡**ï¼š4-6å°æ—¶

---

## ğŸ“Š æ€»ä½“è¿›åº¦è§„åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€æ¨¡å—ï¼ˆæœ€æ–°è¿›åº¦ï¼‰
- âœ… åœ°åŒºç®¡ç†æ¨¡å—ï¼ˆå®Œæˆå¹¶åŠ å›ºï¼šé‰´æƒã€CSRFã€åˆ‡æ¢ã€å®¡è®¡ï¼‰
- âœ… å•†æˆ·ç®¡ç†æ¨¡å—ï¼ˆå®Œæˆï¼‰ 
- âœ… ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼ˆå®Œæˆå¹¶é›†æˆåˆ†æé¡µï¼‰

### é˜¶æ®µ2ï¼šæ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼ˆé¢„è®¡25-35å°æ—¶ï¼‰
- âœ… è¯„ä»·ç®¡ç†æ¨¡å—ï¼ˆ10-14å°æ—¶ï¼‰
- âœ… å¸–å­ç®¡ç†æ¨¡å—ï¼ˆ12-16å°æ—¶ï¼‰
- âœ… è®¢å•ç®¡ç†æ¨¡å—ï¼ˆå¾…è¯¦ç»†è§„åˆ’ï¼‰

### é˜¶æ®µ3ï¼šæ”¯æŒåŠŸèƒ½æ¨¡å—ï¼ˆé¢„è®¡15-20å°æ—¶ï¼‰
- âœ… è®¢é˜…éªŒè¯æ¨¡å—ï¼ˆ6-8å°æ—¶ï¼‰
- âœ… æ¿€åŠ±ç³»ç»Ÿæ¨¡å—ï¼ˆ8-10å°æ—¶ï¼‰
- âœ… ç³»ç»Ÿé…ç½®æ¨¡å—ï¼ˆ4-6å°æ—¶ï¼‰

**æ€»è®¡å·¥ä½œé‡ï¼š70-95å°æ—¶** 
**å·²å®Œæˆï¼š24å°æ—¶** (åœ°åŒºç®¡ç†18å°æ—¶ + å•†æˆ·ç®¡ç†6å°æ—¶)
**é¢„è®¡æ•ˆç‡æå‡**ï¼šåŸºäºåœ°åŒºç®¡ç†æ¨¡å—å»ºç«‹çš„æ¶æ„è§£å†³æ–¹æ¡ˆæ¨¡æ¿ï¼Œåç»­æ¨¡å—å¼€å‘æ•ˆç‡æ˜¾è‘—æå‡

---

## ğŸ”§ æŠ€æœ¯æ ‡å‡†å’Œè§„èŒƒ

### ä»£ç è§„èŒƒ
```python
# ç»Ÿä¸€é”™è¯¯å¤„ç†
@require_auth
async def handle_request(request: Request) -> Response:
    try:
        # ä¸šåŠ¡é€»è¾‘
        data = await manager.get_data()
        return create_response(data)
    except DatabaseException as e:
        logger.error(f"Database error: {e}")
        raise HTTPException(status_code=500, detail="æ•°æ®åº“æ“ä½œå¤±è´¥")
    except Exception as e:
        logger.error(f"Unexpected error: {e}")
        raise HTTPException(status_code=500, detail="ç³»ç»Ÿå†…éƒ¨é”™è¯¯")

# ç»Ÿä¸€å“åº”æ ¼å¼
def create_response(data, message="success"):
    return {
        "status": "success",
        "message": message,
        "data": data,
        "timestamp": datetime.now().isoformat()
    }
```

### UIç»„ä»¶æ ‡å‡†
```python
# ç»Ÿä¸€è¡¨å•ç»„ä»¶
def create_form(title, fields, action):
    return Div(
        H3(title, cls="text-xl font-bold mb-4"),
        Form(
            *[create_field(field) for field in fields],
            Button("ä¿å­˜", type="submit", cls="btn btn-primary"),
            Button("å–æ¶ˆ", type="button", cls="btn btn-ghost ml-2"),
            action=action,
            method="POST"
        )
    )

# ç»Ÿä¸€è¡¨æ ¼ç»„ä»¶
def create_table(headers, data, actions):
    return Div(
        Table(
            Thead(Tr(*[Th(h) for h in headers])),
            Tbody(*[create_row(row, actions) for row in data])
        ),
        cls="overflow-x-auto"
    )
```

### æµ‹è¯•æ ‡å‡†
```javascript
// æ¯ä¸ªåŠŸèƒ½æ¨¡å—å¿…é¡»é€šè¿‡çš„åŸºç¡€æµ‹è¯•
const basicTests = [
  'page-load-test',      // é¡µé¢æ­£å¸¸åŠ è½½
  'data-display-test',   // æ•°æ®æ­£ç¡®æ˜¾ç¤º
  'crud-operations-test', // CRUDæ“ä½œåŠŸèƒ½
  'error-handling-test', // é”™è¯¯å¤„ç†
  'responsive-test'      // å“åº”å¼é€‚é…
];

// æ€§èƒ½æµ‹è¯•æ ‡å‡†
const performanceStandards = {
  pageLoadTime: 2000,    // é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
  apiResponseTime: 1000, // APIå“åº”æ—¶é—´ < 1ç§’
  uiResponseTime: 300    // UIäº¤äº’å“åº” < 300ms
};
```

---

## ğŸ“ˆ è´¨é‡ä¿è¯æµç¨‹

### æ¯ä¸ªæ¨¡å—å®Œæˆåå¿…é¡»é€šè¿‡ï¼š

1. **åŠŸèƒ½æµ‹è¯•**ï¼šæ‰€æœ‰è®¾è®¡åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
3. **æ€§èƒ½æµ‹è¯•**ï¼šæ»¡è¶³å“åº”æ—¶é—´è¦æ±‚
4. **å…¼å®¹æ€§æµ‹è¯•**ï¼šä¸åŒæµè§ˆå™¨å’Œå±å¹•å°ºå¯¸æ­£å¸¸æ˜¾ç¤º
5. **ä»£ç å®¡æŸ¥**ï¼šä»£ç è´¨é‡å’Œè§„èŒƒæ€§æ£€æŸ¥

### æ•´ä½“é¡¹ç›®å®Œæˆæ ‡å‡†ï¼š

- âœ… æ‰€æœ‰14ä¸ªç®¡ç†é¡µé¢æ— 500é”™è¯¯
- âœ… æ‰€æœ‰CRUDæ“ä½œåŠŸèƒ½æ­£å¸¸
- âœ… æ‰€æœ‰Playwrightæµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… UIé£æ ¼ç»Ÿä¸€ï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… é”™è¯¯å¤„ç†å®Œå–„ï¼Œç”¨æˆ·å‹å¥½

---

## ğŸš¨ é‡è¦æŠ€æœ¯å‘ç°ä¸è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ¶æ„é—®é¢˜ (2025-09-15å‘ç°)

**é—®é¢˜æè¿°**ï¼šFastHTML + Starlette æ··åˆæ¶æ„å¯¼è‡´å‰ç«¯æ¸²æŸ“å®Œå…¨å¤±æ•ˆ

**å½±å“èŒƒå›´**ï¼šæ‰€æœ‰ä½¿ç”¨ Starlette Mount æŒ‚è½½çš„Webç®¡ç†æ¨¡å— (é¢„è®¡å…¨éƒ¨14ä¸ªæ¨¡å—)

**æŠ€æœ¯åŸç†**ï¼š
```python
# é—®é¢˜æ¶æ„
app = FastHTML(...)  # ä¸»åº”ç”¨
app.mount("/regions", Mount("", routes=regions_routes))  # StarletteæŒ‚è½½

# å¯¼è‡´ç»“æœ
return create_layout("title", content)  
# è¾“å‡º: (!doctype((),{'html': True}), html(... (Pythonå¯¹è±¡å­—ç¬¦ä¸²)
# è€Œé: <!DOCTYPE html><html>... (æ­£ç¡®HTML)
```

**ç¡®å®šè§£å†³æ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆB - FastHTMLåŸç”Ÿè·¯ç”±é‡æ„**

### æ ‡å‡†é‡æ„æ¨¡æ¿

**æ¯ä¸ªæ¨¡å—é‡æ„æ—¶åº”éµå¾ªçš„æ ‡å‡†æµç¨‹**ï¼š

#### æ­¥éª¤1: æ¶æ„è¯Šæ–­
```bash
# å¿«é€Ÿç¡®è®¤æ˜¯å¦ä¸ºæ¶æ„é—®é¢˜
curl -s "http://localhost:8082/[module]/" | head -1
# å¦‚æœè¾“å‡ºä¸º "(!doctype((),{'html': True})..." åˆ™ç¡®è®¤ä¸ºæ¶æ„é—®é¢˜
```

#### æ­¥éª¤2: ä»£ç è¿ç§» (ä¿æŒ100%ç°æœ‰è®¾è®¡)
```python
# ä» web/routes/[module].py
async def [function_name](request: Request) -> Response:
    # ä¸šåŠ¡é€»è¾‘ä»£ç  (å®Œå…¨ä¿æŒä¸å˜)
    content = Div(...)  # DaisyUIç»„ä»¶ (å®Œå…¨ä¿æŒä¸å˜)
    return create_layout("title", content)

# è¿ç§»åˆ° web/app.py
@app.get("/[module]/")
async def [function_name](request: Request):
    # ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ (ä¸€å­—ä¸æ”¹)
    content = Div(...)  # ç›¸åŒçš„DaisyUIç»„ä»¶ (ä¸€å­—ä¸æ”¹)
    return create_layout("title", content)  # FastHTMLè‡ªåŠ¨æ¸²æŸ“
```

#### æ­¥éª¤3: æ¸…ç†æ—§æ¶æ„
```python
# asgi_app.py ä¸­ç§»é™¤
# app.mount("/[module]", Mount("", routes=[module]_routes))

# åˆ é™¤ web/routes/[module].py (å¤‡ä»½å)
```

### é¢„æœŸæ”¶ç›Š

**æŠ€æœ¯æ”¶ç›Š**ï¼š
- âœ… è§£å†³å‰ç«¯é¡µé¢å®Œå…¨å¤±æ•ˆé—®é¢˜
- âœ… å……åˆ†åˆ©ç”¨FastHTMLæ¸²æŸ“ä¼˜åŒ–
- âœ… ç»Ÿä¸€æ¶æ„ï¼Œæå‡ç»´æŠ¤æ€§

**å¼€å‘æ”¶ç›Š**ï¼š
- âœ… ä¿æŒæ‰€æœ‰ç°æœ‰CSSè®¾è®¡ (DaisyUI + TailwindCSS)
- âœ… ä¿æŒæ‰€æœ‰ç°æœ‰UIç»„ä»¶ (è¡¨æ ¼ã€è¡¨å•ã€æŒ‰é’®ç­‰)
- âœ… ä¿æŒæ‰€æœ‰ç°æœ‰ä¸šåŠ¡é€»è¾‘ (æ•°æ®åº“æ“ä½œã€éªŒè¯ç­‰)

**é¡¹ç›®æ”¶ç›Š**ï¼š
- âœ… ä¸ºå…¶ä»–13ä¸ªæ¨¡å—æä¾›æ ‡å‡†é‡æ„æ¨¡æ¿
- âœ… æ˜¾è‘—å‡å°‘åç»­æ¨¡å—çš„é‡æ„æ—¶é—´
- âœ… ç¡®ä¿æ•´ä½“ç³»ç»Ÿæ¶æ„ä¸€è‡´æ€§

### é‡æ„ä¼˜å…ˆçº§å»ºè®® - æœ€æ–°æ›´æ–°

åŸºäºå·²å®Œæˆæ¨¡å—ç»éªŒï¼Œå®é™…é‡æ„é¡ºåºï¼š

1. **åœ°åŒºç®¡ç†æ¨¡å—** âœ… 100%å®Œæˆ - FastHTMLè¿ç§»å®Œæˆï¼Œå»ºç«‹æ ‡å‡†æ¶æ„æ¨¡æ¿
2. **å•†æˆ·ç®¡ç†æ¨¡å—** âœ… 100%å®Œæˆ - æˆåŠŸåº”ç”¨æˆç†Ÿçš„é‡æ„æ¨¡æ¿
3. **ç”¨æˆ·ç®¡ç†æ¨¡å—** ğŸ”„ ä¸‹ä¸€ä¸ªæ¨è - å¤ç”¨æ¶æ„è§£å†³æ–¹æ¡ˆ
4. **å…¶ä»–12ä¸ªæ¨¡å—** - æ‰¹é‡åº”ç”¨æ ‡å‡†æ¨¡æ¿

**å®é™…æ•ˆç‡æå‡éªŒè¯**ï¼š
- é¦–ä¸ªæ¨¡å—(åœ°åŒºç®¡ç†): 18å°æ—¶ (å«é—®é¢˜å‘ç°å’Œå®Œæ•´è§£å†³æ–¹æ¡ˆè®¾è®¡)
- ç¬¬äºŒä¸ªæ¨¡å—(å•†æˆ·ç®¡ç†): 6å°æ—¶ (ç›´æ¥åº”ç”¨æˆç†Ÿæ–¹æ¡ˆ)
- **æ•ˆç‡æå‡**: 66.7% (ä»18å°æ—¶é™è‡³6å°æ—¶)
- **æ€»èŠ‚çœæ—¶é—´**: é¢„è®¡40-60å°æ—¶

---

è¿™ä¸ªè®¡åˆ’å°†æŒ‡å¯¼æˆ‘ä»¬ç³»ç»Ÿæ€§åœ°é‡æ„æ•´ä¸ªWebç®¡ç†åå°ï¼ŒåŸºäºå·²å‘ç°çš„æ ¸å¿ƒæ¶æ„é—®é¢˜å’ŒéªŒè¯çš„è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿æ¯ä¸ªæ¨¡å—éƒ½è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„è´¨é‡æ ‡å‡†ã€‚
