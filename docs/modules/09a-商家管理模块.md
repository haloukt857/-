# 商家管理模块技术文档 (V2.0)

## 🚨 商户ID统一标准 (引用绑定码模块)

### 商户身份识别方法
```python
# ✅ 统一的商户ID使用标准
# 商户永久ID: merchants.id (与telegram_chat_id解耦)
merchant_id = merchant_data['id']  # 永久ID，不变
telegram_id = merchant_data['telegram_chat_id']  # 可变的TG账号

# 商户查询标准
from database.db_merchants import merchants_manager
merchant = await merchants_manager.get_merchant_by_id(merchant_id)
```

### 绑定码关联查询
```python
# 查看商户绑定信息
from database.db_binding_codes import binding_codes_manager
binding_info = await binding_codes_manager.get_all_binding_codes()
# 通过merchant_id字段关联商户信息
```

---

## 模块概述

本模块专注于商户信息的快速索引和只读查看，是管理员了解和定位特定商户的入口。

### 业务价值
- 提供中心化的商户信息库。
- 通过快速搜索，提升管理员定位商户的效率。
- 为跳转到商户评价、帖子详情等其他模块提供入口。

---

## 核心功能

### 1. 列表与搜索
- **功能**: 页面以简洁列表形式，展示所有商户的`永久ID`和`名称`。
- **交互**: 提供一个置顶的、高效的搜索框，支持通过商户名称进行实时模糊搜索，方便在大量商户中快速定位目标。

### 2. 只读详情页
- **功能**: 点击列表中的商户，可以进入该商户的详情页。此页面**只读不改**，主要用于信息聚合展示。
- **展示内容**:
    - **近期帖子**: 该商户最近发布的帖子内容、发布时间和服务到期时间。
    - **Telegram深度链接**: 系统会自动生成一个格式为 `https://t.me/xiaojisystembot?start=merchant_18` 的链接，管理员点击后可直接在Telegram中打开与该商户的对话或相关信息面板。

### 3. 未来扩展
- **评价系统入口**: 此详情页未来将集成该商户的评价信息，包括综合评分和详细评价列表的入口。
