# 城市与地区管理模块技术文档 (V2.0)

## 模块概述

本模块为整个系统提供地理位置基础数据的管理功能，包括城市（Cities）和地区（Districts）的增删改查。这些数据是商户进行地域标记和用户按地理位置筛选商户的核心基础。

### 业务价值
- **数据标准化**: 确保所有商户的地区信息都来自统一、规范的来源。
- **支持搜索功能**: 为“地区搜索和筛选模块”提供数据支撑。
- **后台灵活配置**: 管理员可以随时通过Web后台调整开放的城市和地区，而无需修改代码。

---

## 数据库设计

本模块依赖两张核心的地理位置数据表。

### 1. `cities` (城市表)
存储顶级的地理划分单位。
```sql
CREATE TABLE IF NOT EXISTS cities (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. `districts` (地区表)
存储隶属于某个城市的二级地理划分单位。
```sql
CREATE TABLE IF NOT EXISTS districts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    city_id INTEGER NOT NULL,
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (city_id) REFERENCES cities(id) ON DELETE CASCADE,
    UNIQUE(name, city_id)
);
```

---

## Web管理后台功能

管理员可以在Web管理后台的“地区管理”页面，对城市和地区进行完整的CRUD（创建、读取、更新、删除）操作。

- **查看**: 以“城市 -> 地区列表”的层级结构清晰展示所有地区数据。
- **创建**: 
    - 可以添加新的城市。
    - 可以在指定的城市下添加新的地区。
- **更新**: 可以修改城市或地区的名称、显示顺序以及激活状态 (`is_active`)。
- **删除**: 可以删除不再需要的地区或整个城市（删除城市将级联删除其下的所有地区）。

通过控制 `is_active` 字段，管理员可以灵活地决定哪些地区在前台对用户可见和可用。
