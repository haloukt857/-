[build]
builder = "nixpacks"

[deploy]
restartPolicyType = "never"

# Web 进程：ASGI 应用（Bot Webhook + 管理面板由 asgi_app/main.py 提供）
[deploy.web]
command = "python3 main.py"
restartPolicyType = "on-failure"
checkTimeout = 300
healthcheckPath = "/health"
healthcheckTimeout = 30

# Worker 进程：定时任务调度器
## 已改为单服务部署：调度器在 web 进程内启动（SCHEDULER_ENABLED=true）

[[deploy.hooks]]
stage = "post-deploy"
command = "python3 scripts/post_deploy_hook.py"

[environments.production]
restartPolicyType = "on-failure"
restartPolicyMaxRetries = 3

[environments.production.variables]
RUN_MODE = "prod"
DEBUG = "false"
USE_WEBHOOK = "true"
SCHEDULER_ENABLED = "true"

[environments.staging]

[environments.staging.variables]
RUN_MODE = "prod"
DEBUG = "true"
USE_WEBHOOK = "true"
WEB_BASE_PATH = "/admin"
